<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>AMDQuery</title>
  <meta charset="utf-8" />
  <link href="../css/reset.css" rel="stylesheet" type="text/css" />
  <link href="../css/document.css" rel="stylesheet" type="text/css" />
  <link href="../css/prettify/prettify-tomorrow.css" rel="stylesheet" type="text/css" />
  <link href="../css/combination.css" rel="stylesheet" type="text/css" />
  <script src="../js/prettify.js" type="text/javascript"></script>
  <script src="../js/lang-css.js"></script>
  <script src="/amdquery/amdquery.js" type="text/javascript" amdquery="debug:false;autoFetchCss:0" amd="detectCR=1" module="transitionToAnimation:0" ui="initWidget:1;isTransform3d:0;autoFetchCss:0"></script>
  <script type="text/javascript" src="../js/main.js"></script>
  <script type="text/javascript">
    $.require(["main/query", "main/event", "ui/swapview"], function(query, event) {
      $(".swip_to_app").click(function(e) {
        $("#swapview").uiSwapview("option", "index", 1);
      });
      $(".swip_to_options").click(function(event) {
        $("#swapview").uiSwapview("option", "index", 2);
      });
    });
  </script>
</head>

<body style="width: 100%; height: 100%;" onload="prettyPrint()">
  <div amdquery-widget="ui.flex" ui-flex="flex:1;flexDriection:row">
    <div style="width:20px;" amdquery-widget="ui.flex" ui-flex="fillParentWidth:false"></div>
    <div class="document" id="swapview" style="" amdquery-widget="ui.swapview;ui.flex" ui-flex="flex:1" ui-swapview="orientation:H">
      <ol>
        <li id="first">
          <div style="width: 100%; height: 100%;" amdquery-widget="ui.scrollableview" ui-scrollableview="orientation:V;enableKeyboard:true;">
            <h1 name="Definition">Build Definition</h1>
            <ul class="guide">
              <li><a href="#Overview">Overview</a>
              </li>
              <li><a href="#Quick">Quick Start</a>
              </li>
              <li><a href="#Browser">Broswer html</a>
              </li>
              <li><a href="#Dependencies">Build Dependencies</a>
              </li>
              <li><a href="#Config">Config</a>
              </li>
              <li><a href="#Detail">Build Detail</a>
              </li>
            </ul>

            <h2 name="Overview">Overview</h2>
            <p>This guide teach you how to combine javascript to a file and minify it. It could reduce file size and http request.</p>
            <p>The Building apply <a target="_blank" href="http://www.nodejs.org">nodejs</a> to build and conbine javascript. It load javascript according to <a target="_blank" href="http://en.wikipedia.org/wiki/Asynchronous_module_definition">AMD</a>
              standard.
            </p>

            <h3 name="Quick">Quick Start</h3>
            <p>Download nodejs and install nodejs. Open terminal and cd directory of amdquery project, cd build.</p>
            <p>Input "npm install" in terminal before start building. NPM will download and install some node modules.</p>
            <p>Input "node build.js build_config.js" and watch the log.
              <p/>
              <p>Look the directory: build/output/defines. Look over "test.js" and "test.debug.js".
                <p/>
                <p>cd "output/apps/document/app", open the "app.html" with a web server.
                  <p/>

                  <h3 name="Browser">Broswer html</h3>
                  <p>Quick start a web server. Input "npm install -g <a target="_blank" href="https://github.com/senchalabs/connect">connect</a>" or "sudo npm install -g <a target="_blank" href="https://github.com/senchalabs/connect">connect</a>". cd root
                    of amdquery directory, input "node server.js". Open browser and input
                    <Strong>"http://localhost:8080/document/app/app.html"</Strong> or
                    <Strong>"http://localhost:8080/build/output/apps/document/app/app.html"</Strong>. You should collect the address in browser.</p>
                  <p>The
                    <a class="swip_to_app">
                      <img src="../images/right.png" width="13px" height="13px" />"Build Application"</a>has detail guide.</p>

                  <h3 name="Dependencies">Build Dependencies</h3>
                  <p>There are node modules to support Build. The "UglifyJS" be used to minify js and detect syntax error. The clean-css be used to minify css. The "trumpet" be used to parse HTML and compile HTML.</p>
                  <p>If you want more infomation, please click the link and read "build.js".</p>
                  <ul class="guide" style="margin-top: 0">
                    <li><a target="_blank" href="https://github.com/isaacs/node-glob">glob</a><span>>3.x.x</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/caolan/async">async</a><span>>0.0.0</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/mishoo/UglifyJS">uglify-js</a><span>~1.x.x</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/GoalSmashers/clean-css">clean-css</a><span>>0.0.0</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/substack/node-trumpet">trumpet</a><span>>0.0.0</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/jashkenas/underscore">underscore</a><span>>0.0.0</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/jprichardson/node-fs-extra">fs-extra</a><span>>0.0.0</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/dominictarr/through">through</a><span>~2.3.4</span>
                    </li>
                    <li><a target="_blank" href="https://github.com/maxogden/node-concat-stream">concat-stream</a><span>~1.0.0</span>
                    </li>
                  </ul>
                  <h2 name="Config">Config</h2>
                  <p>This guide would explain how to config build.</p>
                  <p>cd "build/", open "build_config.js".</p>
                  <pre class="prettyprint" name="DirectoryStructure">
Directory Structure
root
  |- amdquery
  |   \- amdquery.js
  |- document
  |- build
      |- build.js
      |- build_config.js
      |- test
         \- test.js
      \- output
          |- defines
          |   |- test.debug.js
          |   \- test.js
          |- apps
              |- document
              |   \- amdquery
              |       |- amdquery.debug.js
              |       |- amdquery.js
              |       \- ui
              |           |- css
              |           \- iamges
              |- app
                  |- asset
                  |- css
                  |- xml
                  \- app.html
                  </pre>
                  <ul class="ul">
                    <li>
                      <h4>amdqueryPath</h4>
                      <p>Configure amdquery.js path. It is relative of build.js .</p>
                      <p>exports.amdqueryPath = '../amdquery/'; (--amdquery)</p>
                    </li>
                    <li>
                      <h4>projectRootPath</h4>
                      <p>Configure project root path. It is relative of build.js .</p>
                      <p>exports.projectRootPath = '../../'; (--root)</p>
                    </li>
                    <li>
                      <h4>outputPath</h4>
                      <p>All build files will save to outputPath. It is relative of build.js .</p>
                      <p>exports.outputPath = 'output/'; (--output)</p>
                    </li>
                    <li>
                      <h4>pathVariable</h4>
                      <p>exports path to load js. "@app" will parse to "../document/app/app" when you use "require(@app/index.js)"</p>
                      <pre class="prettyprint">
{
  "@app":"../document/app/app",
  "@mypath:":"../test/app/app"
}
                      </pre>
                    </li>
                    <li>
                      <h4>debug</h4>
                      <p>whether print log, true or false</p>
                    </li>
                    <li>
                      <h4>apps</h4>
                      <p>
                        <a class="swip_to_app">
                          <img src="../images/right.png" width="13px" height="13px" />"Build Application"</a>
                      </p>
                    </li>
                    <li>
                      <h4>defines</h4>
                      <pre class="prettyprint">
{
  //The "test" is name of output javascript which will be create in directory "defines".
  //It also create "test.debug.js" which is not minify.
  test: {
    //The "path" is main of the build-js.It is relative "amdquery.js".
    path: "../document/app/asset/source/js/scrollTo.js",
    //The "directory" is array of folder, Building would include all of js under the item-folder.It is relative "amdquery.js".
    directory: [ "ui/" ],
    //The "complete" function will be call when building complete.
    complete: function( minPath, minContent, deubugPath, debugContent ) {
      var FSE = require( 'fs-extra' );
      path = "../document/app/asset/source/js/amdquery.js";
      FSE.writeFile( path, debugContent );
    }
  }
}
                      </pre>
                    </li>
                    <li>
                      <h4>uglifyOptions</h4>
                      <p>
                        <a class="swip_to_options">
                          <img src="../images/right.png" width="13px" height="13px" />"cleanCss And uglify options"</a>
                      </p>
                    </li>
                    <li>
                      <h4>cleanCssOptions</h4>
                      <p>
                        <a class="swip_to_options">
                          <img src="../images/right.png" width="13px" height="13px" />"cleanCss And uglify options"</a>
                      </p>
                    </li>
                  </ul>
                  <h2 name="Detail">Build Detail</h2>
                  <p>1.Read base amdquery.js . we should get the content of amdquery.js, amdquery.js is basal. It began in the file.
                    <br />If you want to start using "AMDQuery", you must first load the "amdquery.js". So Build will be a top priority loaded and stored in the file start position.
                  </p>
                  <p>2.Build defines. Get the main of js from config. Path is "../document/app/asset/source/js/scrollTo.js"
                    <br />The "scrollTo.js" require "[ "main/query", "hash/locationHash", "ui/swapview", "ui/scrollableview" ]".
                    <br />The "oye.node" will find and load these js file, detect dependencies of these js.
                    <br />Finally, get the all of js then combine to a stream.
                  </p>
                  <p>3.Save js file.According to config, to save js. For this example:
                    <br />save "test.debug.js" into "output/defines". "test.debug.js" is not compress, it could debug.
                    <br />save "test.js" into "output/defines". "test.js" is compress.
                  </P>
                  <p>4. If you increase the "complete" function in the configuration, You can do some interesting things after the build is completed.
                    <br />For this example, I write the contents to a new file.
                  </p>
                  <a float="false" href="#Definition" class="Top">Top</a>
          </div>
        </li>
        <li>
          <div style="width: 100%; height: 100%;" amdquery-widget="ui.scrollableview" ui-scrollableview="orientation:V;enableKeyboard:true;">
            <h1>Building Application</h1>
            <ul class="guide">
              <li><a href="#Overview">Overview</a>
              </li>
              <li><a href="#Config">Config</a>
              </li>
              <li><a href="#Detail">Detail</a>
              </li>
              <li><a href="#APP">APP</a>
              </li>
            </ul>

            <h2 name="Overview">Overview</h2>
            <p>This guide will teach you how to build application, How to configure build.
              <br />You also need to know how to create an application.
              <br />If you need more details or to change the build process, you need to have some knowledge about the <a target="_blank" href="http://www.nodejs.org">nodejs</a> and node-modules.
              <br />If you want to build your own js file or css file, you can refer to <a target="_blank" href="https://github.com/mishoo/UglifyJS">uglifyOptions</a> and <a target="_blank" href="https://github.com/GoalSmashers/clean-css">cleanCssOptions</a>.
            </p>

            <h2 name="Config">Config</h2>
            <p>Reference "build_config.js". "apps" is an array, each of which is object.
            </p>
            <ul class="ul">
              <li>
                <h4>name</h4>
                <p>The name of the application.</p>
              </li>
              <li>
                <h4>path</h4>
                <p>Application HTML path.</p>
              </li>
              <li>
                <h4>debug</h4>
                <p>If that is true, that build will create a non-compressed "amdquery.debug.js", set the configuration of application to "true" in HTML</p>
              </li>
              <li>
                <h4>complete</h4>
                <p>The callback of the Build.</p>
                <p>You can do some interesting things after the build is completed.</p>
                <pre class="prettyprint">
//The argument in "complete"
{
  appConfig:
  {
    debug: '1',
    src: '../document/app/app'
  },
  viewContentID; "aQueryViewContentKey",
  cssPath: [ 'css/reset.css' ],
  htmlPath: '/Users/apple/project/my/amdquery/build/../amdquery/../document/app/app.html',
  appProjectPath: '/Users/apple/project/my/amdquery/build/../amdquery/../document/app/',
  appName: 'document',
  projectOutputPath: 'output/apps/document/',
  AMDQueryJSPath: 'apps/document/amdquery/amdquery',
  AMDQueryJSRelativeHTMLPath: '../amdquery/amdquery',
  appCombinationXMLRelativePath: 'xml/combination.xml',
  appCombinationXMLPath: 'output/apps/document/app/xml/combination.xml',
  appCombinationCssRelativePath: 'css/document.css',
  appCombinationCssPath: 'output/apps/document/app/css/document.css',
  uiCombinationCssPath: 'output/apps/document/amdquery/ui/css/amdquery-widget.css',
  outputHtmlPath: 'output/apps/document/app/app.html'
}
                </pre>
              </li>
            </ul>

            <h2 name="Detail">Build Detail</h2>
            <p>1.Open HTML. Get "HTML" path from the configuration.
              <br />Use "trumpet" to parse html, Get an array of css hrefs and script tag of application. Parse configuration of the tag.
            </p>
            <img src="../images/build_open_html.png" />
            <p>2.Create application directory and copy file.
              <br />Create application directory. In this example, path of directory is "output/apps/document/". If the path of directory exists then remove it.
              <br />Copy directory:
              <br />(This example: AMDQueryJSRootPath is "/Users/apple/project/my/amdquery/build/../amdquery/" or "/Users/apple/project/my/amdquery/")
              <br />Copy appProjectPath + "asset/" to "app/asset/"
              <br />Copy appProjectPath + "css/" to "app/css/"
              <br />Copy appProjectPath + "xml/" to "app/xml/"
              <br />Copy appProjectPath + "lib/" to "app/lib/"
              <br />Copy AMDQueryJSRootPath + "ui/css/" to "amdquery/ui/css/"
              <br />Copy AMDQueryJSRootPath + "ui/images/" to "amdquery/ui/images/"
            </p>
            <img src="../images/build_create_and_copy.png" width="628px" height="97px" />
            <p>3.Build Javascript of Application
              <br />Get "app.js" path to the directory. Set "require" parameter with the path. ("@app" ==> "../document/app/app")
              <br />"oye.node" could load all js after setting "require" parameter. Then build save the js files to the output directory. You also can see then log in terminal.
            </p>
            <img src="../images/build_build_js.png" />
            <p>4.Build XML of Application
              <br />Put all the XML merged into one XML. Root tag is "
              <root>". Each original XML will be wrapped in "
                <wrag>" tag within
                  <br />The new XML will be saved as "combination.xml". "combination.xml" is easy for reading.
                  <br />Content of new XML will append into "app.html"
            </p>
            <p>5.Build CSS of Application
              <br />After the first step has been to get all the "CSS" href, this step will be to find those CSS file through the href and use the "clean-css" to merge them into a CSS file.
              <br />The new CSS will be saved as "{#appName}.css" moreover the final step will automatically add a "CSS" tag to "HTML" head, the properties href will be set "css/{#appName}.css".
            </p>
            <p>6.Build CSS of AMDQuery UI
              <br />Build combine all the CSS of AMDQuery UI and save it as "amdquery-widget.css".
            </p>
            <img src="../images/build_build_XML_CSS.png" />
            <p>7.Modify HTML
              <br />Remove all CSS in head and add a new CSS into head, the new CSS href is "css/document.css".
              <br />Modify "amdquery.js" script attribute:
              <br />change "src" as "../app/app"
              <br />change "development" to "false"
              <br />change "debug" as you define in configuration
              <br />XML append into "app.html".
            </p>

            <h2 name="APP">APP</h2>
            <div class="admonition-note">
              <strong>
                <p>Build set the configuration of the "viewContentID" property to "aQueryViewContentKey" and add combination "XML" into "app.html" body in order to synchronize the contents of loaded view.
                <br />This property is used to tell the Application how to find the content view in a non-development model. After building the application development model is false.
                <br />When the view is loading, it look for ID as "viewContentID" of "div" after look for property as "viewContentID" of sub-elements.
                </p>
              </strong>
            </div>
          </div>
        </li>
        <li>
          <div style="width: 100%; height: 100%;" amdquery-widget="ui.scrollableview" ui-scrollableview="orientation:V;enableKeyboard:true;">
            <h1>cleanCss And uglify options</h1>
            <h2><a target="_blank" href="https://github.com/mishoo/UglifyJS">uglifyOptions</a></h2>
            <ul class="ul">
              <li>
                <bold><span class="value">strict_semicolons</span>:boolean[false]</bold>
                <p>disable automatic semicolon insertion and support for trailing comma in arrays and objects.</p>
              </li>
              <li>
                <bold>mangle_options</bold>
                <ul class="ul">
                  <li>
                    <bold><span class="value">mangle</span>:boolean[true]</bold>
                    <p>pass false to skip mangling names.</p>
                  </li>
                  <li>
                    <bold><span class="value">toplevel</span>:boolean[false]</bold>
                    <p>mangle toplevel names (by default we don’t touch them).</p>
                  </li>
                  <li>
                    <bold><span class="value">defines</span>:array[null]</bold>
                    <p>an object with properties named after symbols to replace.</p>
                  </li>
                  <li>
                    <bold><span class="value">except</span>:object[null]</bold>
                    <p>an array of names to exclude from compression.</p>
                  </li>
                  <li>
                    <bold><span class="value">no_functions</span>:boolean[false]</bold>
                    <p>no mangle functions</p>
                  </li>
                </ul>
              </li>
              <li>
                <bold>squeeze_options</bold>
                <ul class="ul">
                  <li>
                    <bold><span class="value">make_seqs</span>:boolean[true]</bold>
                    <p>which will cause consecutive statements in a block to be merged using the “sequence” (comma) operator.</p>
                  </li>
                  <li>
                    <bold><span class="value">dead_code</span>:boolean[true]</bold>
                    <p>which will remove unreachable code.</p>
                  </li>
                  <li>
                    <bold><span class="value">no_warnings</span>:boolean[false]</bold>
                    <p>whether output warnings.</p>
                  </li>
                  <li>
                    <bold><span class="value">keep_comps</span>:boolean[true]</bold>
                    <p>keep comps.</p>
                  </li>
                  <li>
                    <bold><span class="value">unsafe</span>:boolean[false]</bold>
                    <p>enable other additional optimizations that are known to be unsafe in some contrived situations, but could still be generally useful. For now only these:
                      <br />foo.toString() ==> foo+””
                      <br />new Array(x,…) ==> [x,…]
                      <br />new Array(x) ==> Array(x)
                    </p>
                  </li>
                </ul>
              </li>
              <li>
                <bold>gen_options</bold>
                <ul class="ul">
                  <li>
                    <bold><span class="value">indent_start</span>:number[0]</bold>
                    <p>(only applies when beautify is true) – initial indentation in spaces.</p>
                  </li>
                  <li>
                    <bold><span class="value">indent_level</span>:number[4]</bold>
                    <p>(only applies when beautify is true) – indentation level, in spaces (pass an even number).</p>
                  </li>
                  <li>
                    <bold><span class="value">quote_keys</span>:boolean[false]</bold>
                    <p>if you pass true it will quote all keys in literal objects.</p>
                  </li>
                  <li>
                    <bold><span class="value">space_colon</span>:boolean[false]</bold>
                    <p>(only applies when beautify is true) – wether to put a space before the colon in object literals.</p>
                  </li>
                  <li>
                    <bold><span class="value">beautify</span>:boolean[false]</bold>
                    <p>pass true if you want indented output.</p>
                  </li>
                  <li>
                    <bold><span class="value">ascii_only</span>:boolean[false]</bold>
                    <p>pass true if you want to encode non-ASCII characters as \uXXXX.</p>
                  </li>
                  <li>
                    <bold><span class="value">inline_script</span>:boolean[false]</bold>
                    <p>pass true to escape occurrences of</script in strings</p>
                  </li>
                </ul>
              </li>
            </ul>
            <h2><a target="_blank" href="https://github.com/GoalSmashers/clean-css">cleanCssOptions</a></h2>
            <ul class="ul">
              <li>
                <bold><span class="value">keepSpecialComments</span>:string["*"]</bold>
                <p>"*" for keeping all (default), 1 for keeping first one only, 0 for removing all.</p>
              </li>
              <li>
                <bold><span class="value">keepBreaks</span>:boolean[false]</bold>
                <p>whether to keep line breaks (default is false).</p>
              </li>
              <li>
                <bold><span class="value">processImport</span>:boolean[true]</bold>
                <p>whether to process @import rules.</p>
              </li>
              <li>
                <bold><span class="value">noRebase</span>:boolean[false]</bold>
                <p>whether to skip URLs rebasing.</p>
              </li>
              <li>
                <bold><span class="value">noAdvanced</span>:boolean[false]</bold>
                <p>set to true to disable advanced optimizations - selector & property merging, reduction, etc.</p>
              </li>
              <li>
                <bold><span class="value">selectorsMergeMode</span>:string["*"]</bold>
                <p>ie8 for IE8 compatibility mode, * for merging all (default).</p>
              </li>
            </ul>
          </div>
        </li>
      </ol>
      <ol style="width:100px;height:20px;" amdquery-widget="ui.swapindicator" ui-swapindicator="orientation:H">
        <li></li>
        <li></li>
        <li></li>
      </ol>
    </div>
    <div style="width:20px;" amdquery-widget="ui.flex" ui-flex="fillParentWidth:false"></div>
  </div>
</body>

</html>
